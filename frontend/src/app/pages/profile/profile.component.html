<div class="profile-page">
    <div class="profile-container" *ngIf="user">
        <!-- Profile Header with Cover -->
        <div class="profile-header">
            <div class="header-cover">
                <div class="cover-overlay"></div>
                <div class="cover-pattern"></div>
            </div>
            <div class="profile-card">
                <div class="avatar-section">
                    <div class="avatar-wrapper">
                        <img [src]="user.avatar ? 'http://localhost:3000' + user.avatar : 'assets/default-avatar.png'"
                            alt="Avatar" class="avatar-img">
                        <button class="avatar-edit-btn" title="Thay ƒë·ªïi ·∫£nh">
                            <span>üì∑</span>
                        </button>
                        <div class="online-indicator"></div>
                    </div>
                    <div class="user-info">
                        <h1>{{ user.fullName }}</h1>
                        <p class="user-email">{{ user.email }}</p>
                        <span class="role-badge" [ngClass]="user.role">
                            {{ user.role === 'admin' ? 'üëë Qu·∫£n tr·ªã vi√™n' : 'üë§ Th√†nh vi√™n' }}
                        </span>
                    </div>
                </div>

                <!-- Stats Section Inside Card -->
                <div class="stats-section">
                    <div class="stat-item">
                        <span class="stat-value">{{ propertiesCount }}</span>
                        <span class="stat-label">Tin ƒëƒÉng</span>
                        <span class="stat-icon-bg">üè†</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-value">{{ favoritesCount }}</span>
                        <span class="stat-label">Y√™u th√≠ch</span>
                        <span class="stat-icon-bg">‚ù§Ô∏è</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-value">{{ appointmentsCount }}</span>
                        <span class="stat-label">L·ªãch h·∫πn</span>
                        <span class="stat-icon-bg">üìÖ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="profile-grid">
            <!-- Left Column - Personal Info -->
            <div class="profile-column">
                <div class="info-card">
                    <div class="card-header">
                        <div class="header-icon">üìã</div>
                        <h2>Th√¥ng tin c√° nh√¢n</h2>
                        <button class="btn-edit" (click)="toggleEdit()">
                            {{ isEditing ? '‚úï H·ªßy' : '‚úèÔ∏è S·ª≠a' }}
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="info-row">
                            <div class="info-icon">üë§</div>
                            <div class="info-content">
                                <label>H·ªç v√† t√™n</label>
                                <input *ngIf="isEditing" type="text" [(ngModel)]="editData.fullName" class="form-input">
                                <span *ngIf="!isEditing" class="info-value">{{ user.fullName }}</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-icon">‚úâÔ∏è</div>
                            <div class="info-content">
                                <label>Email</label>
                                <input *ngIf="isEditing" type="email" [(ngModel)]="editData.email" disabled
                                    class="form-input disabled">
                                <span *ngIf="!isEditing" class="info-value">{{ user.email }}</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-icon">üì±</div>
                            <div class="info-content">
                                <label>S·ªë ƒëi·ªán tho·∫°i</label>
                                <input *ngIf="isEditing" type="tel" [(ngModel)]="editData.phone"
                                    placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" class="form-input">
                                <span *ngIf="!isEditing" class="info-value" [class.empty]="!user.phone">{{ user.phone ||
                                    'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-icon">üìç</div>
                            <div class="info-content">
                                <label>ƒê·ªãa ch·ªâ</label>
                                <input *ngIf="isEditing" type="text" [(ngModel)]="editData.address"
                                    placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" class="form-input">
                                <span *ngIf="!isEditing" class="info-value" [class.empty]="!user.address">{{
                                    user.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-icon">üé≠</div>
                            <div class="info-content">
                                <label>Vai tr√≤</label>
                                <span class="info-value role-value">{{ user.role === 'admin' ? 'Qu·∫£n tr·ªã vi√™n' : 'Th√†nh
                                    vi√™n' }}</span>
                            </div>
                        </div>

                        <div class="action-buttons" *ngIf="isEditing">
                            <button class="btn-cancel" (click)="toggleEdit()" [disabled]="isSaving">H·ªßy b·ªè</button>
                            <button class="btn-save" (click)="saveProfile()" [disabled]="isSaving">
                                {{ isSaving ? '‚è≥ ƒêang l∆∞u...' : 'üíæ L∆∞u thay ƒë·ªïi' }}
                            </button>
                        </div>
                        <div class="save-message" *ngIf="saveMessage">{{ saveMessage }}</div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Quick Actions & Security -->
            <div class="profile-column">
                <!-- Quick Actions Card -->
                <div class="info-card actions-card">
                    <div class="card-header">
                        <div class="header-icon">‚ö°</div>
                        <h2>Thao t√°c nhanh</h2>
                    </div>
                    <div class="card-body">
                        <div class="actions-list">
                            <a routerLink="/my-properties" class="action-item action-green">
                                <span class="action-icon">üè†</span>
                                <div class="action-content">
                                    <span class="action-title">Qu·∫£n l√Ω BƒêS</span>
                                    <span class="action-desc">Xem v√† qu·∫£n l√Ω tin ƒëƒÉng c·ªßa b·∫°n</span>
                                </div>
                                <span class="action-arrow">‚Üí</span>
                            </a>
                            <a routerLink="/properties/create" class="action-item action-blue">
                                <span class="action-icon">‚ûï</span>
                                <div class="action-content">
                                    <span class="action-title">ƒêƒÉng tin m·ªõi</span>
                                    <span class="action-desc">T·∫°o tin ƒëƒÉng BƒêS m·ªõi</span>
                                </div>
                                <span class="action-arrow">‚Üí</span>
                            </a>
                            <a routerLink="/favorites" class="action-item action-red">
                                <span class="action-icon">‚ù§Ô∏è</span>
                                <div class="action-content">
                                    <span class="action-title">Tin y√™u th√≠ch</span>
                                    <span class="action-desc">Xem danh s√°ch y√™u th√≠ch</span>
                                </div>
                                <span class="action-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Security Card -->
                <div class="info-card security-card">
                    <div class="card-header">
                        <div class="header-icon">üîí</div>
                        <h2>B·∫£o m·∫≠t</h2>
                    </div>
                    <div class="card-body">
                        <div class="security-item" *ngIf="!showPasswordForm">
                            <div class="security-icon">üîê</div>
                            <div class="security-content">
                                <span class="security-title">ƒê·ªïi m·∫≠t kh·∫©u</span>
                                <span class="security-desc">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u m·ªõi</span>
                            </div>
                            <button class="btn-security" (click)="togglePasswordForm()">Thay ƒë·ªïi</button>
                        </div>

                        <!-- Password Change Form -->
                        <div *ngIf="showPasswordForm" class="password-form">
                            <div class="form-header">
                                <span class="form-icon">üîê</span>
                                <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
                                <button class="btn-close" (click)="togglePasswordForm()">‚úï</button>
                            </div>
                            <p class="form-notice">Vui l√≤ng nh·∫≠p ƒë√∫ng email v√† s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ x√°c minh danh t√≠nh</p>

                            <div class="form-group">
                                <label>‚úâÔ∏è Email x√°c minh</label>
                                <input type="email" [(ngModel)]="passwordData.email" placeholder="Nh·∫≠p email c·ªßa b·∫°n"
                                    class="form-input">
                            </div>
                            <div class="form-group">
                                <label>üì± S·ªë ƒëi·ªán tho·∫°i x√°c minh</label>
                                <input type="tel" [(ngModel)]="passwordData.phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                                    class="form-input">
                            </div>
                            <div class="form-divider"></div>
                            <div class="form-group">
                                <label>üîë M·∫≠t kh·∫©u c≈©</label>
                                <input type="password" [(ngModel)]="passwordData.oldPassword"
                                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>üîê M·∫≠t kh·∫©u m·ªõi</label>
                                <input type="password" [(ngModel)]="passwordData.newPassword"
                                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>‚úÖ X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                                <input type="password" [(ngModel)]="passwordData.confirmPassword"
                                    placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" class="form-input">
                            </div>

                            <div class="password-message" *ngIf="passwordMessage"
                                [class.success]="passwordMessage.includes('‚úÖ')">
                                {{ passwordMessage }}
                            </div>

                            <div class="form-actions">
                                <button class="btn-cancel" (click)="togglePasswordForm()">H·ªßy</button>
                                <button class="btn-submit" (click)="changePassword()" [disabled]="isChangingPassword">
                                    {{ isChangingPassword ? '‚è≥ ƒêang x·ª≠ l√Ω...' : 'üíæ ƒê·ªïi m·∫≠t kh·∫©u' }}
                                </button>
                            </div>
                        </div>

                        <div class="security-divider" *ngIf="!showPasswordForm"></div>
                        <button class="btn-logout-full" (click)="logout()" *ngIf="!showPasswordForm">
                            <span>üö™</span> ƒêƒÉng xu·∫•t t√†i kho·∫£n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading" *ngIf="!user">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>ƒêang t·∫£i th√¥ng tin...</p>
        </div>
    </div>
</div>
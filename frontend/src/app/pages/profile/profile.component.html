<div class="profile-container">
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Äang táº£i há»“ sÆ¡...</p>
  </div>

  <div *ngIf="error && !loading" class="alert alert-danger">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="user && !loading" class="profile-card">
    <div class="profile-header">
      <div class="profile-avatar-container" (click)="triggerFileInput(fileInput)">
        <img [src]="getAvatarUrl()" alt="Avatar" class="profile-avatar-img">
        <div class="avatar-overlay">
          <span>ğŸ“· Äá»•i hÃ¬nh ná»n</span>
        </div>
        <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" accept="image/*">
      </div>

      <div class="profile-info-right">
        <h1 class="profile-name">{{ user.fullName }}</h1>
        <span [ngClass]="'badge ' + getRoleBadgeClass(user.role)">
          {{ getRoleLabel(user.role) }}
        </span>
      </div>
    </div>

    <div class="profile-content">
      <div class="profile-section">
        <div class="section-header">
          <h3>ThÃ´ng Tin CÃ¡ NhÃ¢n</h3>
          <button *ngIf="!isEditing" class="btn btn-edit" (click)="toggleEdit()">
            âœï¸ Chá»‰nh sá»­a
          </button>
        </div>

        <!-- View Mode -->
        <div *ngIf="!isEditing" class="info-grid">
          <div class="info-item">
            <label>ğŸ“§ Email</label>
            <p>{{ user.email }}</p>
          </div>

          <div class="info-item">
            <label>ğŸ†” ID</label>
            <p>#{{ user.userId || user.id }}</p>
          </div>

          <div *ngIf="user.phone" class="info-item">
            <label>ğŸ“± Sá»‘ Äiá»‡n Thoáº¡i</label>
            <p>{{ user.phone }}</p>
          </div>

          <div class="info-item">
            <label>ğŸ‘¥ Vai TrÃ²</label>
            <p>{{ getRoleLabel(user.role) }}</p>
          </div>

          <div *ngIf="user.createdAt" class="info-item">
            <label>ğŸ“… NgÃ y Táº¡o TÃ i Khoáº£n</label>
            <p>{{ user.createdAt | date: 'dd/MM/yyyy HH:mm' }}</p>
          </div>

          <div *ngIf="user.updatedAt" class="info-item">
            <label>ğŸ”„ Cáº­p Nháº­t Láº§n Cuá»‘i</label>
            <p>{{ user.updatedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
          </div>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="isEditing" class="edit-form">
          <div class="form-group">
            <label>ğŸ“ Há» vÃ  TÃªn</label>
            <input type="text" class="edit-input" [(ngModel)]="editForm.fullName" placeholder="Nháº­p há» vÃ  tÃªn">
          </div>

          <div class="form-group">
            <label>ğŸ“§ Email</label>
            <input type="email" class="edit-input" [(ngModel)]="editForm.email" placeholder="Nháº­p email">
          </div>

          <div class="form-group">
            <label>ğŸ“± Sá»‘ Äiá»‡n Thoáº¡i</label>
            <input type="tel" class="edit-input" [(ngModel)]="editForm.phone" placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i">
          </div>

          <div class="form-group">
            <label>ğŸ‘¥ Vai TrÃ²</label>
            <div class="role-selector">
              <button type="button" class="role-trigger" (click)="toggleRoleDropdown()">
                {{ getSelectedRoleLabel() }}
                <span class="dropdown-arrow">â–¼</span>
              </button>
              <div *ngIf="showRoleDropdown" class="role-dropdown">
                <div *ngFor="let role of availableRoles" class="role-option"
                  [class.selected]="editForm.role === role.value" (click)="selectRole(role.value)">
                  {{ role.label }}
                </div>
              </div>
            </div>
          </div>

          <div class="edit-actions">
            <button class="btn btn-success" (click)="saveProfile()">ğŸ’¾ LÆ°u</button>
            <button class="btn btn-secondary" (click)="cancelEdit()">âŒ Há»§y</button>
          </div>
        </div>
      </div>

      <div class="profile-actions">
        <button class="btn btn-danger" (click)="logout()">
          ğŸšª ÄÄƒng Xuáº¥t
        </button>
      </div>
    </div>
  </div>
</div>
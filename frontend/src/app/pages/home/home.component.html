<div class="home-container">
    <div class="header-actions">
        <h1 class="featured-title">‚≠ê Tin n·ªïi b·∫≠t</h1>
        <button (click)="goToCreate()" class="btn-create">‚ûï ƒêƒÉng Tin M·ªõi</button>
    </div>

    <!-- Search & Filter Bar -->
    <div class="filter-bar">
        <!-- Row 1: Search & Basic Filters -->
        <div class="filter-row">
            <input type="text" [(ngModel)]="filters.search" placeholder="üîç T√¨m theo t√™n, ƒë·ªãa ch·ªâ, ng∆∞·ªùi ƒëƒÉng..."
                class="filter-input search-input">

            <select [(ngModel)]="filters.listingTypeId" class="filter-input">
                <option [ngValue]="null">T·∫•t c·∫£ lo·∫°i</option>
                <option *ngFor="let lt of listingTypes" [ngValue]="lt.id">{{ lt.name }}</option>
            </select>

            <input type="number" [(ngModel)]="filters.minPrice" placeholder="Gi√° t·ª´ (VND)"
                class="filter-input price-input">
            <input type="number" [(ngModel)]="filters.maxPrice" placeholder="Gi√° ƒë·∫øn (VND)"
                class="filter-input price-input">
        </div>

        <!-- Row 2: Advanced Filters -->
        <div class="filter-row">
            <select [(ngModel)]="filters.cityId" (ngModelChange)="onCityChange()" class="filter-input">
                <option [ngValue]="null">-- T·ªânh/Th√†nh ph·ªë --</option>
                <option *ngFor="let city of cities" [ngValue]="city.id">{{ city.name }}</option>
            </select>

            <select [(ngModel)]="filters.districtId" class="filter-input" [disabled]="!filters.cityId">
                <option [ngValue]="null">-- Qu·∫≠n/Huy·ªán --</option>
                <option *ngFor="let d of districts" [ngValue]="d.id">{{ d.name }}</option>
            </select>

            <input type="number" [(ngModel)]="filters.minArea" placeholder="DT t·ª´ (m¬≤)" class="filter-input area-input">
            <input type="number" [(ngModel)]="filters.maxArea" placeholder="DT ƒë·∫øn (m¬≤)"
                class="filter-input area-input">

            <input type="number" [(ngModel)]="filters.bedrooms" placeholder="Ph√≤ng ng·ªß" class="filter-input room-input"
                min="0">
            <input type="number" [(ngModel)]="filters.bathrooms" placeholder="Ph√≤ng t·∫Øm" class="filter-input room-input"
                min="0">
        </div>

        <!-- Filter Actions -->
        <div class="filter-actions">
            <button (click)="loadProperties()" class="btn-filter">üîç T√¨m ki·∫øm</button>
            <button (click)="resetFilters()" class="btn-reset">‚Ü∫ X√≥a l·ªçc</button>
        </div>
    </div>

    <div class="property-grid">
        <div *ngFor="let prop of properties" class="property-card">
            <div class="card-image-container" [routerLink]="['/properties', prop.id]" style="cursor: pointer;">
                <img [src]="prop.imageUrl ? 'http://localhost:3000' + prop.imageUrl : 'assets/house-placeholder.jpg'"
                    alt="Property Image" class="property-img">
                <button class="heart-btn" (click)="toggleLike(prop, $event)" [class.liked]="prop.liked">
                    ‚ù§Ô∏è
                </button>
            </div>
            <div class="property-info" [routerLink]="['/properties', prop.id]" style="cursor: pointer;">
                <span class="type-badge" [ngClass]="prop.listingType?.code === 'rent' ? 'rent' : 'sale'">
                    {{ prop.listingType?.name || 'B·∫•t ƒë·ªông s·∫£n' }}
                </span>
                <h3>{{ prop.title }}</h3>
                <p class="price">{{ prop.price | number }} VND</p>
                <p class="address">üìç {{ prop.address }}</p>
                <p class="area" *ngIf="prop.area">üìê {{ prop.area }} m¬≤</p>
                <p class="location" *ngIf="prop.district">
                    üèôÔ∏è {{ prop.district.name }}<span *ngIf="prop.district.city">, {{ prop.district.city.name }}</span>
                </p>
            </div>
            <div class="poster-info" *ngIf="prop.owner">
                <img [src]="prop.owner.avatar ? 'http://localhost:3000' + prop.owner.avatar : 'assets/default-avatar.png'"
                    alt="Poster Avatar" class="poster-avatar">
                <div class="poster-details">
                    <span class="poster-name">{{ prop.owner.fullName }}</span>
                    <span class="poster-phone" *ngIf="prop.owner.phone">üìû {{ prop.owner.phone }}</span>
                </div>
            </div>
            <div class="card-actions">
                <button [routerLink]="['/booking', prop.id]" class="btn-booking" (click)="$event.stopPropagation()">
                    üìÖ ƒê·∫∑t l·ªãch / Li√™n h·ªá
                </button>
            </div>
        </div>
    </div>

    <div *ngIf="properties.length === 0" class="no-properties">
        <p>Ch∆∞a c√≥ tin ƒëƒÉng n√†o.</p>
    </div>
</div>
<div class="home-container">
    <div class="header-actions">
        <h1 class="featured-title">‚≠ê Tin n·ªïi b·∫≠t</h1>
        <button (click)="goToCreate()" class="btn-create">‚ûï ƒêƒÉng Tin M·ªõi</button>
    </div>

    <!-- Main Content Layout: Grid + Sidebar -->
    <div class="main-layout">
        <!-- Left: Property Grid -->
        <div class="content-area">
            <!-- Sort & Results Info -->
            <div class="sort-bar">
                <span class="result-count">üìä T√¨m th·∫•y {{ totalItems }} k·∫øt qu·∫£</span>

                <div class="sort-controls">
                    <label>S·∫Øp x·∫øp:</label>
                    <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()" class="sort-select">
                        <option value="createdAt">M·ªõi nh·∫•t</option>
                        <option value="price">Gi√°</option>
                        <option value="area">Di·ªán t√≠ch</option>
                        <option value="views">L∆∞·ª£t xem</option>
                    </select>
                    <select [(ngModel)]="sortOrder" (ngModelChange)="onSortChange()" class="sort-select">
                        <option value="DESC">Gi·∫£m d·∫ßn</option>
                        <option value="ASC">TƒÉng d·∫ßn</option>
                    </select>
                </div>
            </div>

            <div class="property-grid">
                <div *ngFor="let prop of properties" class="property-card">
                    <div class="card-image-container" [routerLink]="['/properties', prop.id]" style="cursor: pointer;">
                        <img [src]="prop.imageUrl ? 'http://localhost:3000' + prop.imageUrl : 'assets/house-placeholder.jpg'"
                            alt="Property Image" class="property-img">
                        <button class="heart-btn" (click)="toggleLike(prop, $event)" [class.liked]="prop.liked">
                            ‚ù§Ô∏è
                        </button>
                        <span class="views-badge" *ngIf="prop.views">üëÅÔ∏è {{ prop.views }}</span>
                    </div>
                    <div class="property-info" [routerLink]="['/properties', prop.id]" style="cursor: pointer;">
                        <span class="type-badge" [ngClass]="prop.listingType?.code === 'rent' ? 'rent' : 'sale'">
                            {{ prop.listingType?.name || 'B·∫•t ƒë·ªông s·∫£n' }}
                        </span>
                        <h3>{{ prop.title }}</h3>
                        <p class="price">{{ prop.price | number }} VND</p>
                        <p class="address">üìç {{ prop.address }}</p>
                        <p class="area" *ngIf="prop.area">üìê {{ prop.area }} m¬≤</p>
                        <p class="location" *ngIf="prop.district">
                            üèôÔ∏è {{ prop.district.name }}<span *ngIf="prop.district.city">, {{ prop.district.city.name
                                }}</span>
                        </p>
                    </div>
                    <div class="poster-info" *ngIf="prop.owner">
                        <img [src]="prop.owner.avatar ? 'http://localhost:3000' + prop.owner.avatar : 'assets/default-avatar.png'"
                            alt="Poster Avatar" class="poster-avatar">
                        <div class="poster-details">
                            <span class="poster-name">{{ prop.owner.fullName }}</span>
                            <span class="poster-phone" *ngIf="prop.owner.phone">üìû {{ prop.owner.phone }}</span>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button [routerLink]="['/booking', prop.id]" class="btn-booking"
                            (click)="$event.stopPropagation()">
                            üìÖ ƒê·∫∑t l·ªãch / Li√™n h·ªá
                        </button>
                    </div>
                </div>
            </div>

            <div *ngIf="properties.length === 0" class="no-properties">
                <p>Ch∆∞a c√≥ tin ƒëƒÉng n√†o.</p>
            </div>

            <!-- Pagination -->
            <div class="pagination" *ngIf="totalPages > 1">
                <button class="page-btn" (click)="goToPage(1)" [disabled]="currentPage === 1">¬´</button>
                <button class="page-btn" (click)="prevPage()" [disabled]="currentPage === 1">‚Äπ</button>

                <button *ngFor="let page of getPageNumbers()" class="page-btn" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </button>

                <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">‚Ä∫</button>
                <button class="page-btn" (click)="goToPage(totalPages)"
                    [disabled]="currentPage === totalPages">¬ª</button>

                <span class="page-info">Trang {{ currentPage }} / {{ totalPages }}</span>
            </div>
        </div>

        <!-- Right: Sticky Filter Sidebar -->
        <div class="filter-sidebar">
            <div class="filter-sidebar-content">
                <h3 class="filter-title">üîç T√¨m ki·∫øm & L·ªçc</h3>

                <!-- Search -->
                <div class="sidebar-group">
                    <label>T·ª´ kh√≥a</label>
                    <input type="text" [(ngModel)]="filters.search" placeholder="T√¨m theo t√™n, ƒë·ªãa ch·ªâ..."
                        class="sidebar-input" (keyup.enter)="loadProperties()">
                </div>

                <!-- Listing Type -->
                <div class="sidebar-group">
                    <label>üìã Lo·∫°i giao d·ªãch</label>
                    <select [(ngModel)]="filters.listingTypeId" class="sidebar-select"
                        (ngModelChange)="loadProperties()">
                        <option [ngValue]="null">T·∫•t c·∫£ lo·∫°i</option>
                        <option *ngFor="let lt of listingTypes" [ngValue]="lt.id">{{ lt.name }}</option>
                    </select>
                </div>

                <!-- Location -->
                <div class="sidebar-group">
                    <label>üìç T·ªânh/Th√†nh ph·ªë</label>
                    <select [(ngModel)]="filters.cityId" (ngModelChange)="onCityChange()" class="sidebar-select">
                        <option [ngValue]="null">T·∫•t c·∫£</option>
                        <option *ngFor="let city of cities" [ngValue]="city.id">{{ city.name }}</option>
                    </select>
                </div>

                <div class="sidebar-group" *ngIf="filters.cityId">
                    <label>üè† Qu·∫≠n/Huy·ªán</label>
                    <select [(ngModel)]="filters.districtId" class="sidebar-select">
                        <option [ngValue]="null">T·∫•t c·∫£</option>
                        <option *ngFor="let d of districts" [ngValue]="d.id">{{ d.name }}</option>
                    </select>
                </div>

                <!-- Price Range -->
                <div class="sidebar-group">
                    <label>üí∞ Kho·∫£ng gi√° (VND)</label>
                    <div class="range-inputs">
                        <input type="number" [(ngModel)]="filters.minPrice" placeholder="T·ª´" class="range-input">
                        <span>-</span>
                        <input type="number" [(ngModel)]="filters.maxPrice" placeholder="ƒê·∫øn" class="range-input">
                    </div>
                </div>

                <!-- Area Range -->
                <div class="sidebar-group">
                    <label>üìê Di·ªán t√≠ch (m¬≤)</label>
                    <div class="range-inputs">
                        <input type="number" [(ngModel)]="filters.minArea" placeholder="T·ª´" class="range-input">
                        <span>-</span>
                        <input type="number" [(ngModel)]="filters.maxArea" placeholder="ƒê·∫øn" class="range-input">
                    </div>
                </div>

                <!-- Rooms -->
                <div class="sidebar-group">
                    <label>üõèÔ∏è Ph√≤ng ng·ªß / Ph√≤ng t·∫Øm</label>
                    <div class="range-inputs">
                        <input type="number" [(ngModel)]="filters.bedrooms" placeholder="PN" class="range-input"
                            min="0">
                        <input type="number" [(ngModel)]="filters.bathrooms" placeholder="PT" class="range-input"
                            min="0">
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="sidebar-actions">
                    <button (click)="loadProperties()" class="btn-apply">üîç √Åp d·ª•ng</button>
                    <button (click)="resetFilters()" class="btn-reset-sidebar">‚Ü∫ X√≥a l·ªçc</button>
                </div>
            </div>
        </div>
    </div>
</div>
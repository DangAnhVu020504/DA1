<div class="my-properties-container">
    <div class="page-header">
        <h1>üè† Qu·∫£n l√Ω B·∫•t ƒë·ªông s·∫£n</h1>
        <button *ngIf="!showForm" class="btn-create" (click)="openCreateForm()">
            ‚ûï T·∫°o BDS m·ªõi
        </button>
    </div>

    <!-- Inline Form -->
    <div *ngIf="showForm" class="property-form-container">
        <div class="form-header">
            <h2>{{ isEditing ? '‚úèÔ∏è S·ª≠a B·∫•t ƒë·ªông s·∫£n' : '‚ûï T·∫°o BDS m·ªõi' }}</h2>
            <button class="close-form-btn" (click)="closeForm()">‚úï</button>
        </div>

        <div *ngIf="formError" class="alert alert-danger">{{ formError }}</div>

        <form (ngSubmit)="onSubmit()" #form="ngForm">
            <div class="form-row">
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ tin *</label>
                    <input type="text" [(ngModel)]="property.title" name="title" required class="form-control"
                        placeholder="VD: Nh√† ph·ªë 3 t·∫ßng Qu·∫≠n 7">
                </div>
            </div>

            <div class="form-row two-columns">
                <div class="form-group">
                    <label>Lo·∫°i giao d·ªãch *</label>
                    <select [(ngModel)]="property.listingTypeId" name="listingTypeId" required class="form-control">
                        <option [ngValue]="null">-- Ch·ªçn lo·∫°i --</option>
                        <option *ngFor="let lt of listingTypes" [ngValue]="lt.id">{{ lt.name }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Lo·∫°i BƒêS *</label>
                    <select [(ngModel)]="property.typeId" name="typeId" required class="form-control">
                        <option [ngValue]="null">-- Ch·ªçn lo·∫°i BƒêS --</option>
                        <option *ngFor="let pt of propertyTypes" [ngValue]="pt.id">{{ pt.name }}</option>
                    </select>
                </div>
            </div>

            <div class="form-row two-columns">
                <div class="form-group">
                    <label>T·ªânh/Th√†nh ph·ªë *</label>
                    <select [(ngModel)]="selectedCityId" name="cityId" (ngModelChange)="onCityChange()" required
                        class="form-control">
                        <option [ngValue]="null">-- Ch·ªçn th√†nh ph·ªë --</option>
                        <option *ngFor="let city of cities" [ngValue]="city.id">{{ city.name }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Qu·∫≠n/Huy·ªán *</label>
                    <select [(ngModel)]="property.districtId" name="districtId" required class="form-control"
                        [disabled]="!selectedCityId">
                        <option [ngValue]="null">-- Ch·ªçn qu·∫≠n/huy·ªán --</option>
                        <option *ngFor="let d of districts" [ngValue]="d.id">{{ d.name }}</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>ƒê·ªãa ch·ªâ c·ª• th·ªÉ *</label>
                    <input type="text" [(ngModel)]="property.address" name="address" required class="form-control"
                        placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng">
                </div>
            </div>

            <div class="form-row two-columns">
                <div class="form-group">
                    <label>M·ª©c gi√° (VND) *</label>
                    <input type="number" [(ngModel)]="property.price" name="price" required class="form-control">
                </div>

                <div class="form-group">
                    <label>Di·ªán t√≠ch (m¬≤) *</label>
                    <input type="number" [(ngModel)]="property.area" name="area" required class="form-control">
                </div>
            </div>

            <div class="form-row two-columns">
                <div class="form-group">
                    <label>S·ªë ph√≤ng ng·ªß</label>
                    <input type="number" [(ngModel)]="property.bedrooms" name="bedrooms" class="form-control" min="0">
                </div>

                <div class="form-group">
                    <label>S·ªë ph√≤ng t·∫Øm</label>
                    <input type="number" [(ngModel)]="property.bathrooms" name="bathrooms" class="form-control" min="0">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>M√¥ t·∫£ chi ti·∫øt</label>
                    <textarea [(ngModel)]="property.description" name="description" rows="4" class="form-control"
                        placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ b·∫•t ƒë·ªông s·∫£n..."></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>H√¨nh ·∫£nh m√¥ t·∫£</label>
                    <input type="file" (change)="onFileSelected($event)" accept="image/*" class="form-control-file">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" [disabled]="!form.valid || formLoading" class="btn btn-primary">
                    {{ formLoading ? 'ƒêang x·ª≠ l√Ω...' : (isEditing ? 'üíæ L∆∞u thay ƒë·ªïi' : 'üì§ T·∫°o BDS') }}
                </button>
                <button type="button" (click)="closeForm()" class="btn btn-secondary">H·ªßy</button>
            </div>
        </form>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i danh s√°ch...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !showForm && properties.length === 0" class="empty-state">
        <div class="empty-icon">üè°</div>
        <h3>B·∫°n ch∆∞a c√≥ b·∫•t ƒë·ªông s·∫£n n√†o</h3>
        <p>B·∫Øt ƒë·∫ßu b·∫±ng c√°ch t·∫°o tin ƒëƒÉng m·ªõi</p>
        <button class="btn-create-large" (click)="openCreateForm()">
            ‚ûï T·∫°o BDS ƒë·∫ßu ti√™n
        </button>
    </div>

    <!-- Property Grid -->
    <div *ngIf="!loading && !showForm && properties.length > 0" class="property-grid">
        <div *ngFor="let prop of properties" class="property-card">
            <div class="property-image">
                <img [src]="prop.imageUrl ? 'http://localhost:3000' + prop.imageUrl : 'assets/default-property.jpg'"
                    alt="property">
                <span class="status-badge" [class]="prop.status">
                    {{ getStatusLabel(prop.status!) }}
                </span>
            </div>

            <div class="property-content">
                <h3 class="property-title">{{ prop.title }}</h3>
                <p class="property-address">üìç {{ prop.address }}</p>
                <p class="property-price">üí∞ {{ prop.price | number }} VNƒê</p>

                <div class="property-meta">
                    <span *ngIf="prop.bedrooms">üõèÔ∏è {{ prop.bedrooms }} PN</span>
                    <span *ngIf="prop.bathrooms">üöø {{ prop.bathrooms }} WC</span>
                    <span *ngIf="prop.area">üìê {{ prop.area }} m¬≤</span>
                </div>
            </div>

            <div class="property-actions">
                <button class="btn-action btn-edit" (click)="openEditForm(prop)" title="S·ª≠a">
                    ‚úèÔ∏è S·ª≠a
                </button>
                <button class="btn-action btn-delete" (click)="deleteProperty(prop.id!)" title="X√≥a">
                    üóëÔ∏è X√≥a
                </button>
                <button class="btn-action btn-publish" (click)="publishProperty(prop.id!)"
                    [disabled]="prop.status === 'available'" title="ƒêƒÉng tin">
                    üì¢ ƒêƒÉng tin
                </button>
            </div>
        </div>
    </div>
</div>
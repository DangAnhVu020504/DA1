<div class="favorites-container">
    <h1 class="page-title">â¤ï¸ Tin YÃªu ThÃ­ch</h1>

    <!-- Search & Filter Bar -->
    <div *ngIf="!loading && favorites.length > 0" class="filter-bar">
        <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
            placeholder="ğŸ” TÃ¬m theo tiÃªu Ä‘á», Ä‘á»‹a chá»‰..." class="search-input">

        <select [(ngModel)]="typeFilter" (ngModelChange)="onTypeFilterChange()" class="type-select">
            <option value="all">ğŸ“‹ Táº¥t cáº£ loáº¡i</option>
            <option value="sale">ğŸ·ï¸ NhÃ  bÃ¡n</option>
            <option value="rent">ğŸ”‘ Cho thuÃª</option>
        </select>

        <span class="result-count">{{ filteredFavorites.length }} / {{ favorites.length }} tin</span>
    </div>

    <div *ngIf="loading" class="loading">
        <p>Äang táº£i...</p>
    </div>

    <div *ngIf="!loading && favorites.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ’”</div>
        <h2>ChÆ°a cÃ³ tin yÃªu thÃ­ch</h2>
        <p>HÃ£y thÃªm tin yÃªu thÃ­ch báº±ng cÃ¡ch nháº¥n vÃ o nÃºt â¤ï¸ trÃªn cÃ¡c tin BÄS</p>
        <a routerLink="/home" class="btn-home">ğŸ  Vá» trang chá»§</a>
    </div>

    <div *ngIf="!loading && filteredFavorites.length > 0" class="property-grid">
        <div *ngFor="let fav of filteredFavorites" class="property-card">
            <div class="card-image-container" [routerLink]="['/properties', getProperty(fav)?.id]"
                style="cursor: pointer;">
                <img [src]="getProperty(fav)?.imageUrl ? 'http://localhost:3000' + getProperty(fav)?.imageUrl : 'assets/house-placeholder.jpg'"
                    alt="Property Image" class="property-img">
                <button class="heart-btn liked" (click)="removeFavorite(fav.propertyId, $event)" title="Bá» yÃªu thÃ­ch">
                    â¤ï¸
                </button>
            </div>
            <div class="property-info" [routerLink]="['/properties', getProperty(fav)?.id]" style="cursor: pointer;">
                <span class="type-badge" [ngClass]="getProperty(fav)?.listingType?.code === 'rent' ? 'rent' : 'sale'">
                    {{ getProperty(fav)?.listingType?.name || 'Báº¥t Ä‘á»™ng sáº£n' }}
                </span>
                <h3>{{ getProperty(fav)?.title }}</h3>
                <p class="price">{{ getProperty(fav)?.price | number }} VND</p>
                <p class="address">ğŸ“ {{ getProperty(fav)?.address }}</p>
                <p class="area" *ngIf="getProperty(fav)?.area">ğŸ“ {{ getProperty(fav)?.area }} mÂ²</p>
                <p class="location" *ngIf="getProperty(fav)?.district">
                    ğŸ™ï¸ {{ getProperty(fav)?.district?.name }}<span *ngIf="getProperty(fav)?.district?.city">, {{
                        getProperty(fav)?.district?.city?.name }}</span>
                </p>
            </div>
            <div class="poster-info" *ngIf="getProperty(fav)?.owner">
                <img [src]="getProperty(fav)?.owner?.avatar ? 'http://localhost:3000' + getProperty(fav)?.owner?.avatar : 'assets/default-avatar.png'"
                    alt="Poster Avatar" class="poster-avatar">
                <div class="poster-details">
                    <span class="poster-name">{{ getProperty(fav)?.owner?.fullName }}</span>
                    <span class="poster-phone" *ngIf="getProperty(fav)?.owner?.phone">ğŸ“ {{
                        getProperty(fav)?.owner?.phone }}</span>
                </div>
            </div>
            <div class="card-actions">
                <button [routerLink]="['/booking', getProperty(fav)?.id]" class="btn-booking"
                    (click)="$event.stopPropagation()">
                    ğŸ“… Äáº·t lá»‹ch / LiÃªn há»‡
                </button>
            </div>
        </div>
    </div>
</div>
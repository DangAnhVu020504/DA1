<div class="detail-container">
    <div *ngIf="loading" class="loading">ƒêang t·∫£i...</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div *ngIf="property" class="property-detail">
        <a routerLink="/home" class="back-link">‚Üê Quay l·∫°i danh s√°ch</a>

        <div class="detail-content">
            <div class="image-section">
                <img [src]="property.imageUrl ? 'http://localhost:3000' + property.imageUrl : 'assets/house-placeholder.jpg'"
                    alt="{{ property.title }}" class="main-image">

                <!-- Video Section -->
                <div class="video-section" *ngIf="property.videoUrl">
                    <h3>üé¨ Video gi·ªõi thi·ªáu</h3>
                    <video controls class="property-video">
                        <source [src]="'http://localhost:3000' + property.videoUrl" type="video/mp4">
                        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video.
                    </video>
                </div>
            </div>

            <div class="info-section">
                <h1 class="title">{{ property.title }}</h1>
                <p class="price">{{ property.price | number }} VND</p>
                <p class="address">üìç {{ property.address }}</p>

                <div class="seller-info" *ngIf="property.user">
                    <h3>Th√¥ng tin ng∆∞·ªùi b√°n</h3>
                    <div class="seller-card">
                        <div class="seller-avatar">
                            <img [src]="property.user.avatar ? 'http://localhost:3000' + property.user.avatar : 'assets/default-avatar.png'"
                                alt="Seller">
                        </div>
                        <div>
                            <p class="seller-name">{{ property.user.fullName }}</p>
                            <p class="seller-email">üìß {{ property.user.email }}</p>
                            <p class="seller-phone" *ngIf="property.user.phone">üì± {{ property.user.phone }}</p>
                        </div>
                    </div>
                    <button [routerLink]="['/booking', property.id]" class="btn-booking-detail">
                        üìÖ ƒê·∫∑t l·ªãch h·∫πn / Li√™n h·ªá
                    </button>
                </div>

                <div class="description-section">
                    <h3>M√¥ t·∫£ chi ti·∫øt</h3>
                    <p class="description">{{ property.description }}</p>
                </div>

                <!-- Comments Section -->
                <div class="comments-section">
                    <h3>üí¨ B√¨nh lu·∫≠n</h3>

                    <!-- Comment form - show different UI based on login status -->
                    <div class="comment-form">
                        <div *ngIf="!isLoggedIn()" class="login-prompt">
                            <p>üîí <a routerLink="/login">ƒêƒÉng nh·∫≠p</a> ƒë·ªÉ b√¨nh lu·∫≠n</p>
                        </div>

                        <div *ngIf="isLoggedIn()">
                            <textarea [(ngModel)]="newComment" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." rows="3"
                                [disabled]="submittingComment"></textarea>
                            <button (click)="submitComment()" [disabled]="!newComment.trim() || submittingComment">
                                {{ submittingComment ? 'ƒêang g·ª≠i...' : 'G·ª≠i b√¨nh lu·∫≠n' }}
                            </button>
                        </div>

                        <!-- Error message -->
                        <div *ngIf="commentError" class="comment-error">
                            ‚ö†Ô∏è {{ commentError }}
                        </div>

                        <!-- Success message -->
                        <div *ngIf="commentSuccess" class="comment-success">
                            ‚úÖ {{ commentSuccess }}
                        </div>
                    </div>

                    <div class="comments-list">
                        <div *ngFor="let comment of comments" class="comment-item">
                            <div class="comment-avatar">
                                <img [src]="comment.user?.avatar ? 'http://localhost:3000' + comment.user.avatar : 'assets/default-avatar.png'"
                                    alt="Avatar">
                            </div>
                            <div class="comment-content">
                                <div class="comment-header">
                                    <span class="comment-author">{{ comment.user?.fullName }}</span>
                                    <span class="comment-date">{{ comment.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                                </div>
                                <p class="comment-text">{{ comment.content }}</p>
                            </div>
                        </div>
                        <p *ngIf="comments.length === 0" class="no-comments">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>